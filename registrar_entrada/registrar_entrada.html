<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registrar entrada - TimeSnap</title>
  <link rel="stylesheet" href="../global.css">
  <link rel="stylesheet" href="registrar_entrada.css">
</head>
<body>
  <div class="check-wrapper">

    <!-- Header -->
    <header class="header entrada-header">
      <h1>ENTRADA</h1>
    </header>

    <!-- Logo -->
    <div class="logo">
      <img src="logo.png" alt="TimeSnap" />
    </div>

    <p class="instruction">
      Mantén tu rostro dentro del cuadro, procura que el lugar esté iluminado
    </p>

    <!-- Cámara -->
    <div class="camera-box">
      <video id="video" autoplay playsinline></video>
      <canvas id="canvas"></canvas>
    </div>

    <!-- Información de fecha y hora -->
    <div class="info">
      <div>
        <strong>Fecha de hoy:</strong> <span id="currentDate"></span>
      </div>
      <div>
        <strong>Hora de entrada:</strong> <span id="currentTime"></span>
      </div>
    </div>

    <!-- Botones -->
    <div class="buttons">
      <div class="photo-section">
        <button class="btn-photo" id="btnCamera">
          <img src="camara.png" alt="Tomar foto" />
        </button>
      </div>

      <div class="confirm-buttons">
        <button class="btn-red" id="btnCancel">Cancelar</button>
        <button class="btn-green2" id="btnConfirm">Confirmar</button>
      </div>

      <div class="back-button">
        <button class="btn-blue" onclick="window.location.href='../Dashboard/dashboard.html'">Volver a Inicio</button>
      </div>
    </div>
  </div>

<!-- Face API Scripts -->
<script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
<script>
  // Cargar modelos de face-api.js
  async function loadModels() {
    try {
      // Intentar con diferentes URLs de modelos
      const urls = [
        'https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/weights/',
        'https://cdn.jsdelivr.net/npm/@vladmandic/face-api@1.2.0/model/',
        'https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights/'
      ];

      for (const baseUrl of urls) {
        try {
          console.log('Intentando cargar modelos desde:', baseUrl);
          await Promise.all([
            faceapi.nets.tinyFaceDetector.loadFromUri(baseUrl),
            faceapi.nets.faceLandmark68Net.loadFromUri(baseUrl),
            faceapi.nets.faceRecognitionNet.loadFromUri(baseUrl)
          ]);
          console.log('✅ Modelos de face-api.js cargados exitosamente desde:', baseUrl);
          return true;
        } catch (urlError) {
          console.warn('URL falló:', baseUrl, urlError);
          continue;
        }
      }

      console.error('❌ No se pudieron cargar los modelos desde ninguna URL');
      return false;
    } catch (error) {
      console.error('❌ Error cargando modelos de face-api.js:', error);
      return false;
    }
  }

  // Iniciar carga de modelos
  loadModels();
</script>

  <!-- Script compilado TS -->
  <script src="registrar_entrada.js"></script>
</body>
</html>
